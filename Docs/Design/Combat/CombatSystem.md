# 전투 시스템 기획

## 개요

사이드스크롤 전투 필드의 구조와 연속 스폰 + 적 기지 격파 기반 전투 진행 흐름을 다룬다.
플레이어는 영웅을 직접 이동시키며, 카드를 사용하여 유닛 소환 및 스펠을 시전한다.

## 관련 문서

- [영웅 시스템](../Global/Hero.md) - 영웅 이동, HP, 카드 기반 행동
- [덱 시스템](../CardDeck/Deck.md) - 마나, 덱 순환, 핸드/드로우
- [유닛 시스템](Unit.md) - 유닛 스탯, 행동 패턴
- [적 스폰 시스템](EnemySpawn.md) - 예산 기반 스폰, 시간 경과 강화

---

## 1. 전투 화면 UI

```
┌─────────────────────────────────────────────────────────┐
│  [영웅 HP ████]      마나: 7/10   [적 기지HP ████]      │
│  [유물 아이콘 목록...]                    [일시정지]  │
│                                                         │
│  ┌─────────────────────────────────────────────────┐    │
│  │                                                 │    │
│  │  [영웅 ★] ← 아군 유닛들 → ← 적 유닛들 → [적 기지]│    │
│  │                                                 │    │
│  └─────────────────────────────────────────────────┘    │
│                                                         │
│  ┌────┐ ┌────┐ ┌────┐ ┌────┐ ┌────┐ ┌────┐ ┌────┐    │
│  │카드│ │카드│ │카드│ │카드│ │카드│ │카드│ │카드│    │
│  │ 1  │ │ 2  │ │ 3  │ │ 4  │ │ 5  │ │ 6  │ │ 7  │    │
│  └────┘ └────┘ └────┘ └────┘ └────┘ └────┘ └────┘    │
│                              [리드로우 🔄] [덱] [버린 더미]│
└─────────────────────────────────────────────────────────┘
```

### 1.1 상단 HUD

| 요소 | 위치 | 설명 |
|------|------|------|
| 영웅 HP | 좌상단 | HP 바 + 수치 표시 |
| 마나 | 상단 중앙 | 현재/최대 마나 + 게이지 |
| 적 기지 HP | 우상단 | HP 바 + 수치 표시 |
| 유물 | 좌측 2열 | 보유 유물 아이콘 (호버 시 설명 팝업) |
| 일시정지 | 우상단 | 일시정지 버튼 |

### 1.2 전투 필드

- 화면 중앙 대부분을 차지
- 배경은 권역/스테이지에 따라 변경
- 유닛 위에 HP 바 표시
- 데미지 숫자 팝업 (피격 시)

### 1.3 핸드 영역

- 하단 고정
- 카드는 좌우로 나열, 중앙 정렬
- 사용 가능한 카드는 밝게, 마나 부족 카드는 어둡게
- 카드 호버 시 확대 + 상세 정보 표시
- 드래그로 필드에 놓아 사용

---

## 2. 필드 구조

```
[영웅 ★ (HP, 수동 이동)] ←── 전선 이동 ──→ [적 기지 (HP)]
        ↓                                       ↓
  화면 왼쪽 끝에서 아군 유닛 출현           적 유닛 생산
        → → → →  충돌  ← ← ← ←
```

- 영웅과 적 기지는 모두 [유닛](Unit.md)의 하위 타입이며, HP·피격·유닛 효과 등 공통 속성을 공유한다
- 영웅은 필드에 직접 존재하며 플레이어가 좌우로 이동 조작
- 적 기지는 HP를 보유한 고정 구조물
- 아군 유닛은 **화면 왼쪽 가장자리**에서 출현하여 적 기지 방향으로 자동 전진
- 적 유닛은 적 기지에서 출현하여 영웅 방향으로 자동 전진
- 유닛이 상대(적 기지 또는 영웅)에 도달하면 데미지
- 전선은 양측 전력에 따라 실시간으로 밀고 당겨짐

- **영웅 HP는 캠페인 전체에서 유지**되며, 전투에서 받은 피해가 누적된다. 휴식 노드에서 회복 가능
- 적 기지 HP는 매 전투마다 스테이지 데이터에 의해 별도 설정됨

- 배경은 스테이지별로 변화 (같은 권역 내에서도 진행에 따라 변경)
- 패럴랙스 스크롤링으로 깊이감 연출

---

## 3. 승리 / 패배 조건

| 조건 | 노드 유형 | 설명 |
|------|-----------|------|
| **승리** | 일반/엘리트 | 적 기지 HP를 0으로 만들면 스테이지 클리어 |
| **승리** | 보스 | 적 기지 격파 후 등장하는 보스 유닛까지 격파하면 클리어 |
| **패배** | 공통 | 영웅 HP가 0이 되면 즉시 패배 (캠페인 종료) |

---

## 4. 전투 흐름

### 4.1 일반/엘리트 전투

```
[전투 시작] → [영웅 필드 배치 + 적 유닛 생산 시작] → [실시간 전투 (전선 형성)]
                                                              ↓
                                                    [시간 경과에 따라 적 강화]
                                                              ↓
                                              [적 기지 파괴 = 승리 / 영웅 HP 0 = 패배]
```

1. **전투 시작**: 영웅이 화면 왼쪽에 배치, 초기 핸드 드로우, 마나 0에서 시작 (이후 자동 누적)
2. **유닛 생산**: 플레이어는 카드로, 적은 AI 스폰 테이블에 따라 유닛 생산
3. **실시간 전투**: 양측 유닛이 전장에서 충돌, 카드 사용 + 영웅 이동과 자동 전투가 동시 진행
4. **전선 변동**: 한쪽이 우세하면 전선이 밀리며, 상대측에 접근 가능
5. **전투 종료**: 적 기지 HP가 0이 되면 승리

### 4.2 보스 전투

```
[1단계: 기지전]                    [2단계: 보스전]
일반 전투와 동일하게 진행     →     적 기지 격파
                                        ↓
                                  통상 스폰 중단
                                  보스 유닛 등장
                                        ↓
                              보스 격파 = 승리 / 영웅 HP 0 = 패배
```

- **1단계 (기지전)**: 일반 전투와 동일. 적 기지가 예산 기반으로 유닛 생산
- **2단계 (보스전)**: 적 기지 HP 0 → 통상 스폰 중단 → 보스 유닛 출현. 보스 격파 시 클리어
- **페이즈 전환 시**: 필드의 기존 아군/적 유닛은 그대로 유지. 통상 스폰만 중단
- **클리어 시**: 보스 격파 시 필드의 모든 적 유닛이 제거되며 전투 종료

---

## 5. 적 스폰 시스템

상세는 [적 스폰 시스템](EnemySpawn.md) 문서 참고.

- 적은 웨이브 없이 **연속적으로** 유닛을 생산
- 시간 경과에 따라 스폰 풀과 간격이 강화됨
- 적 기지는 HP가 낮아지면 버스트 스폰 발동

---

## 6. 일시정지

```
┌─────────────────────┐
│     일시정지         │
│                     │
│   [계속하기]         │
│   [설정]             │
│   [포기하기]         │
│                     │
└─────────────────────┘
```
