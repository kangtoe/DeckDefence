# 적 스폰 시스템 기획

## 개요

적 기지는 웨이브 없이 **연속적으로** 유닛을 생산한다.
시간이 경과할수록 더 강한 적이 더 빠르게 등장하여 플레이어를 압박한다.

## 관련 문서

- [전투 시스템](CombatSystem.md) - 필드 구조, 승리/패배 조건
- [유닛 시스템](Unit.md) - 유닛 스탯, 행동 패턴
- [적 시스템](Enemy.md) - 적 역할 태그, 권역별 적 구성

---

## 1. 스폰 방식

### 1.1 연속 스폰

- 적 기지는 일정 간격마다 유닛을 자동 생산
- 웨이브 구분 없이 전투 시작부터 종료까지 계속됨
- 스폰 간격과 예산은 **경과 시간**에 따라 변화

### 1.2 예산 기반 스폰 (Budget System)

적 기지는 일정 간격마다 **예산(Budget)**을 받고, 그 예산 내에서 유닛을 생산한다.

- 각 적 타입은 **유닛 벨류**를 가짐 (강할수록 높은 벨류)
- 스폰 주기마다 예산이 주어지면, 예산 내에서 유닛 조합을 결정
- 시간이 지날수록 주기당 예산이 증가 → 자연스러운 난이도 상승

```
예시) 벨류가 1, 2, 3, 4인 적 타입이 있을 때

스폰 주기 1 (예산 3):  벨류1 + 벨류2         = 3
스폰 주기 2 (예산 5):  벨류2 + 벨류3          = 5
스폰 주기 3 (예산 8):  벨류4 + 벨류3 + 벨류1  = 8
```

### 1.3 예산 증가 규칙

| 요소 | 설명 |
|------|------|
| **기본 예산** | 스테이지 시작 시 주기당 예산 |
| **증가량** | 스폰 주기마다 예산에 더해지는 값 |
| **스폰 주기** | 예산이 주어지는 간격 (초). 전투 내 고정값 |

### 1.4 유닛 선택 방식

- 현재 예산 내에서 소환 가능한 적 중 **가중치 랜덤**으로 선택
- 예산을 다 쓸 때까지 반복
- 스테이지별로 등장 가능한 적 풀(Pool)이 다름
- 상위 적은 벨류가 높아 초반 낮은 예산으로는 자연스럽게 등장이 제한됨

---

## 2. 난이도 곡선

### 2.1 시간 경과 강화

스폰 주기는 **고정**이며, 주기당 예산만 **선형 증가**한다.

```
주기당 예산 = 초기 예산 + (경과 주기 × 예산 증가량)
```

- 시간이 흐를수록 한 주기에 더 많은/강한 적이 소환되어 자연스럽게 압박 증가
- 적 풀은 **심도**([맵 & 노드](../Global/Map.md))에 따라 캠페인 진행도 기준으로 확장됨

### 2.2 스테이지 유형별 차이

| 유형 | 초기 예산 | 예산 증가 속도 | 적 기지 HP | 특징 |
|------|-----------|---------------|-----------|------|
| **일반** | 낮음 | 느림 | 보통 | 기본 전투 |
| **엘리트** | 보통 | 보통 | 높음 | 전투 변형 효과 2~3개 적용 |
| **보스** | 높음 | 빠름 | 매우 높음 | 보스 유닛이 직접 출전 |

### 2.3 엘리트 전투 변형 효과

엘리트 전투에는 전투 전체에 적용되는 변형 효과가 **2~3개** 무작위로 부여된다.
별도의 엘리트 적 타입이 존재하는 것이 아니라, 기존 적에 전투 규칙이 변형되는 방식이다.

| 효과 | 설명 | 구현 |
|------|------|------|
| **대규모 침공** | 훨씬 더 많은 적이 스폰됨 | 예산 증가량 2배 |
| **정예 부대** | 적의 스탯이 크게 증가 | 모든 적 HP/ATK x1.5 |

> 위 효과는 예시이며, 엘리트 노드는 추후 구현 시 효과 목록을 확장한다.

### 2.4 심도/디센션 스케일링

- 심도 레벨/디센션 레벨에 따라 적 스폰 예산 증가량 상승 및 스탯 추가 배율

---

## 3. 버스트 스폰

기지 HP가 임계값 이하로 떨어지면, 통상 스폰과 별도로 **버스트 스폰**이 발동한다.
버스트 스폰은 짧은 시간 내에 다량의 적을 한꺼번에 쏟아내는 방식이다.

| 기지 HP 구간 | 버스트 예산 | 스폰 간격 |
|-------------|-----------|-----------|
| 75% 이하 | 소 | 빠름 |
| 50% 이하 | 중 | 매우 빠름 |
| 25% 이하 | 대 | 매우 빠름 |

- 각 임계값은 **1회만 발동**
- 통상 스폰은 버스트 스폰 중에도 계속 유지됨
- 버스트 예산 소진 후에는 통상 스폰만 남음 → "밀어붙이면 결국 부순다"

---

## 4. 주요 요소 목록

### 적 타입 요소

| 요소 | 설명 |
|------|------|
| 적 타입 ID | 적 종류 식별자 |
| 유닛 벨류 | 예산에서 차감되는 비용. 강할수록 높음 |
| 선택 가중치 | 스폰 풀 내 등장 확률 가중치 |

### 스테이지 스폰 요소

| 요소 | 설명 |
|------|------|
| 적 풀 | 해당 스테이지에서 등장 가능한 적 목록 |
| 초기 예산 | 첫 스폰 주기의 예산 |
| 예산 증가량 | 주기마다 예산에 더해지는 값 |
| 스폰 주기 | 예산이 주어지는 간격 (초) |
| 기지 방어 임계값 | HP 구간별 긴급 반응 (예산 보너스, 추가 유닛 등) |
